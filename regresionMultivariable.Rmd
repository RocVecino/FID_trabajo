---
title: "Estudio de análisis de regresión"
author: "Rocío Vecino Torres"
date: "29/12/2021"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
tinytex::install_tinytex()
```

# Estudio de análisis de regresión

Vamos a trabajar con un Excel, llamado StudentsPerformance, que contendrá datos de 1.000 observaciones y con 8 variables que tendrá la información de: genero, raza, nivel de estudios de los padres, si comieron, si hicieron el exámen de preparación, y los resultados de los exámenes en Writting, Reading y Matemáticas.

-   Género: tiene valor de mujer o masculino.

-   Raza: tiene valores de Grupo A, B, C, D, E.

-   Nivel de educación de los padres: bacherlor´s degree (licenciatura), some college cd (algún grado), master´s degree (maestría), associate´s degree (grado asociado), high school (instituo), some high school.

-   Comida: completa o reducida.

-   Test de preparación del exámen: completa o ninguna.

-   Resultados en los examenes de Writting, Reding y Matemáticas: Valores numéricos del 1 al 100.

Para comenzar, cargamos las librerias que serán necesarias.

```{r}
library(tidyverse)
library(ggplot2)
library(dplyr)
```

Y cargamos los datos del fichero .csv:

```{r}
#En un primer lugar cargaremos los datos: 
students_data <- read.csv("StudentsPerformance.csv", sep = ',', head = TRUE)
students_data$id <- NULL
colnames(students_data)
```

## Estudio 1: Regresión multivariable.

Para realizar la regresión multivariable, se deben de realizar los siguientes puntos:  

1.  Dibujar los resultados de los exámenes de Matemáticas, Reading y Writing en función del resto de variables para observar si hay una relación lineal. 

[Resultados de los exámenes de matemáticas:]{.ul}  

Se estudia la relación entre los resultados del examen de matemáticas y dos variables: el género del estudiante y la preparación para el examen.

```{r}
#relación entre los resultados del examen de matemáticas y dos variables: el género del estudiante y la preparación para el exámen
ggplot(students_data, aes(x = gender, y = math.score)) + geom_boxplot() + facet_grid(~test.preparation.course)
```

Como resultado, se puede ver que:

-   Los hombres tienen un puntuaje un poco mayor que las mujeres de media. Los hombres tienen menos valores atípicos, sus datos difieren menos entre ellos. 

-   El curso de preparación ayudo a los estudiantes a lograr mejores resultados. Obteniendo un promedio más alto y valores menos atípicos. 

Se estudia la relación entre los resultados del examen de matemáticas y lo que han comido los estudiantes.

```{r}
#relación entre los resultados del examen de matemáticas y la comida del estudiante
ggplot(students_data, aes(x = lunch, y = math.score))+ geom_boxplot()
```

Como resultado de la gráfica, se observa que:

-   Los estudiantes que comieron una comida standard obtuvieron mayor nota que los que comieron una comida reducida. Aunque, ambas tienen valores atípicos. 

Se estudia la relación entre los resultados del examen de matemáticas y el nivel academico de los padres de los estudiantes.

```{r}
#relación entre los resultados del examen de matemáticas y el nivel de estudios de los padres
ggplot(students_data, aes(x = parental.level.of.education, y = math.score))+ geom_boxplot()
```

Como resultado, se puede ver lo siguiente:

-   Los estudiantes cuyos padres tienen un nivel de educación de maestría (Master´s degree) tiene un promedio un poco más alto con respecto a los demás. El promedio de los que tiene un nivel de estudios de licenciado o de grado (associate´s degree, bachelor´s degree, some college) están muy igualados entre sí. Tienen más bajo promedio aquellos cuyo nivel educativo de los padres es de instituto (high school). Se puede ver también que los datos del nivel educativo de los padres de Master y grado asociado (associate´s degree) no tienen valores atípicos.  

[Resultados de los exámenes de Lectura (Reading):]{.ul}

Se estudia la relación entre los resultados del examen de lectura y dos variables: el género del estudiante y la preparación para el [exámen]{.ul}.

```{r}
#relación entre los resultados del examen de lectura y dos variables: el género del estudiante y la preparación para el exámen
ggplot(students_data, aes(x = gender, y = reading.score)) + geom_boxplot() + facet_grid(~test.preparation.course)
```

Como resultado, se observa lo siguiente:

-   Las mujeres tienen un puntuaje de lectura más alto en promedio, pero tiene más valores atípicos.

-   Una vez más el curso de preparación hace que los estudiantes obtengas mejores resultados. 

Se estudia la relación entre los resultados del examen de lectura y lo que han comido los estudiantes.

```{r}
#relación entre los resultados del examen de lectura y la comida del estudiante
ggplot(students_data, aes(x = lunch, y = reading.score))+ geom_boxplot()
```

Como resultado, se observa lo siguiente:

-   Nuevamente, los estudiantes que comieron una comida standard obtuvieron mejores resultados en el exámen.

Se estudia la relación entre los resultados del examen de lectura y el nivel academico de los padres de los estudiantes.

```{r}
#relación entre los resultados del examen de lectura y el nivel de estudios de los padres
ggplot(students_data, aes(x = parental.level.of.education, y = reading.score))+ geom_boxplot()

```

Como resultado, se puede ver lo siguiente:

-   Se observa aproximádamente lo mismo que en los resultados de matemáticas, con la diferencia de que hay menos valores atípicos.

[Resultados de los exámenes de Escritura (Writing):]{.ul}

Se estudia la relación entre los resultados del examen de escritura y dos variables: el género del estudiante y la preparación para el exámen.

```{r}
#relación entre los resultados del examen de escritura y dos variables: el género del estudiante y la preparación para el exámen
ggplot(students_data, aes(x = gender, y = writing.score)) + geom_boxplot() + facet_grid(~test.preparation.course)
```

Como resultado, se observa que:

-   Las mujeres tienen un puntuaje de escritura más alto en promedio, pero tiene más valores atípicos.  

-   Una vez más el curso de preparación hace que los estudiantes obtengas mejores resultados. 

Se estudia la relación entre los resultados del examen de escritura y lo que han comido los estudiantes.

```{r}
#relación entre los resultados del examen de escritura y la comida del estudiante
ggplot(students_data, aes(x = lunch, y = writing.score))+ geom_boxplot()
```

Como resultado, se puede ver que:

-   Nuevamente, los estudiantes que comieron una comida standard obtuvieron mejores resultados en el exámen.

Se estudia la relación entre los resultados del examen de escritura y lo que han comido los estudiantes.

```{r}
#relación entre los resultados del examen de escritura y el nivel de estudios de los padres
ggplot(students_data, aes(x = parental.level.of.education, y = writing.score))+ geom_boxplot()

```

Como resultado se puede ver que:

-   Se observa aproximadamente lo mismo que en los resultados de matemáticas y reading, con la diferencia de que hay menos valores atípicos. Pero en general en los tres, se ve que a mayor nivel educativo de los padres mayor puntuaje en las notas de los tres exámenes.

Ahora, realizamos una comparación de los resultados de los examenes (Escritura, Lectura y Matemáticas) en función del género y la raza/etnia. 

[Exámenes de Matemáticas:]{.ul} Los estudiantes del grupo E son los que obtienen mejores resultados. El grupo A es el que tiene peor resultado en el examen. Se sigue viendo que los hombres tienen mejores resultados en el examen de matemáticas. 

```{r}
ggplot(students_data, aes(x = gender, y = math.score)) + geom_boxplot() + facet_grid(~race.ethnicity)
```

[Exámenes de Lectura (Reading):]{.ul} Nuevamente, se ve que el grupo E obtiene mejores resultados. Pero no hay tanta diferencia entre las notas de los alumnos como ocurrió con los exámenes de matemáticas. Lo que sí se puede ver significativamente que las mujeres (como se vio anteriormente) que las mujeres obtienen mejores resultados en los exámenes de Lectura.  

```{r}
ggplot(students_data, aes(x = gender, y = reading.score)) + geom_boxplot() + facet_grid(~race.ethnicity)
```

Exámenes de Escritura (Writing): Se observa lo mismo que ha ocurrido en la anterior gráfica. Los estudiantes del grupo E son los que obtienen mejores resultados en escritura.   

```{r}
ggplot(students_data, aes(x = gender, y = writing.score)) + geom_boxplot() + facet_grid(~race.ethnicity)
```

Por último, se hace una comparación entre los resultados de los exámenes:  

[Resultados de Matemáticas Vs. Resultados de Lectura (Reading):]{.ul} Se observa que si los estudiantes obtuvieron una nota alta en matemáticas hay mucha posibilidad de que también lo hagan en lectura. 

```{r}
ggplot(students_data, aes(x = math.score, y = reading.score)) + geom_point()
```

[Resultados de Escritura (Writing) Vs. Resultados de Lectura (Reading):]{.ul} Este gráfico muestra que existe una correlación más alta que en el gráfico anterior.  

```{r}
ggplot(students_data, aes(x = writing.score, y = reading.score)) + geom_point()
```

[Resultados de Matemáticas Vs. Resultados de Escritura (Writing):]{.ul} Se observa que a mayor nota de Matemáticas mayor nota de Escritura (Writing). Pero tiene menos correlación que en el anterior.  

```{r}
ggplot(students_data, aes(x = writing.score, y = math.score)) + geom_point()
```

2.  Construimos el modelo lineal para predecir el resultado de los examenes en funcion del resto de variables.

    Creamos los datasets de entrenamiento y de pruebas (test). De tal forma que usamos 800 observaciones de entrenamiento y 200 para las pruebas de test.

```{r}
  set.seed(1)
  sample = sample(nrow(students_data), floor(nrow(students_data) * 0.8))
  datos_entrenamiento = students_data[sample,]
  datos_test = students_data[-sample,]
  
  dim(datos_entrenamiento)
  dim(datos_test)
```

Lo siguiente es construir el modelo predictivo para cada uno de los exámenes (Matemáticas, Lectura y Escritura). 

[Modelo para Matemáticas:]{.ul}

```{r}
modelo_matematicas = lm(math.score~.,data = datos_entrenamiento)
summary(modelo_matematicas)
```

Se observan las siguientes observaciones:  

-   R cuadrado es del 0,878. Esto quiere decir que el 87,8% de los resultados de los exámenes de matemáticas está sujeto al comportamiento de las variables. Todas las variables son importantes en el modelo.  

-   El coeficiente de estimación para el género Masculino es de 13,58. Esto quiere decir que la nota promedia del sexo masculino es mayor que la nota promedia del sexo femenino. 

-   El coeficiente de estimación para la raza/etnia del grupo E es del 4,96. Esto quiere decir que el promedio de nota para la etnia del Grupo E es mayor que para el grupo A. 

-   El coeficiente de estimación para la comida de tipo standard es de 2,94. Esto quiere decir que el promedio de nota para los estudiantes que comieron comida de tipo standard es mayor que para los que comieron reducida. 

-   El coeficiente de estimación para la variable de test de preparación es de 3,52. Esto quiere decir que los estudiantes que no realizaron un test de preparación para el examen tienen mayor nota promedia que los que si lo realizaron.  

[Modelo para Lectura(Reading):]{.ul}

```{r}
modelo_lectura = lm(reading.score~.,data = datos_entrenamiento)
summary(modelo_lectura)
```

Se observa lo siguiente:

-   R cuadrado es de 0,9284. Esto quiere decir que el 92,8% de los resultados de los exámenes de Lectura (Reading) esta sujeto al comportamiento de las variables.

-   También, destacan los coeficientes de estimación de: Test de preparación para el exámen y el nivel academico de los padres.

[Modelo para Escritura (Writing):]{.ul}

```{r}
modelo_escritura = lm(writing.score~.,data = datos_entrenamiento)
summary(modelo_escritura)
```

Se puede observar que:

-   R cuadrado es de 0,9494. Es decir, que le 94,94% de los resultados de los exámenes de Escritura (Writing) está sujeto al comportamiento de las variables.

-   Destacan los coeficientes de estimación de: raza o etnia, nivel academico de los padres (master y bachelor degree) y test de preparación del examen.

    3.  Predicción del modelo y rendimiento.

Una vez construidos los 3 modelos, es tiempo de usar la funcion predict() para predecir dado un modelo los resultados con el dataset de pruebas que hicimos anteriormente. Y calcular el rendimiento del modelo, calculando el RMSE (Root Mean Square Error - Raíz del error cuadratico medio)

[Predicción modelo del examen de Matemáticas:]{.ul}

```{r}
pred_mates = predict(modelo_matematicas, newdata = datos_test)
sqrt(mean((datos_test$math.score - pred_mates)^2))
```

//TODO observaciones

[Predicción modelo del examen de Lectura(Reading):]{.ul}

```{r}
pred_reading = predict(modelo_lectura, newdata = datos_test)
sqrt(mean((datos_test$reading.score - pred_reading)^2))
```

//TODO observaciones

[Predicción modelo del examen de Escritura (Writing):]{.ul}

```{r}
pred_writing = predict(modelo_escritura, newdata = datos_test)
sqrt(mean((datos_test$writing.score - pred_writing)^2))
```

//TODO observaciones

## Estudio 2: Uso de Random Forest

## Referencias. 

<https://fhernanb.github.io/libro_regresion/predict.html>

<https://www.kaggle.com/yervandtadevosyan/linear-regression-students-performance>
